# Lambda関数 環境変数設定ガイド

## 概要

Lambda関数で使用するDynamoDBテーブル名を環境変数で管理します。
環境変数が設定されていない場合は、デフォルトのテーブル名が使用されます。

## 設定する環境変数

| 環境変数名 | 説明 | デフォルト値（未設定時） |
|-----------|------|----------------------|
| `TABLE_USERSTAMPS` | UserStampsテーブル名 | `UserStamps` |
| `TABLE_STAMPMASTERS` | StampMastersテーブル名 | `StampMasters` |
| `TABLE_USERS` | Usersテーブル名 | `Users` |

## 設定手順（AWSコンソール）

### 1. Lambda関数の環境変数設定画面を開く

1. AWS Lambda コンソールにログイン
2. 設定したいLambda関数を選択（例: `stamp-rally-stamps`）
3. 「設定」タブ → 「環境変数」をクリック
4. 「編集」ボタンをクリック

### 2. 環境変数を追加

#### 開発環境（dev）の場合

| キー | 値 |
|-----|-----|
| `TABLE_USERSTAMPS` | `UserStamps` |
| `TABLE_STAMPMASTERS` | `StampMasters` |
| `TABLE_USERS` | `Users` |

#### 本番環境（prod）の場合

環境ごとに異なるテーブル名を使う場合:

| キー | 値 |
|-----|-----|
| `TABLE_USERSTAMPS` | `UserStamps-prod` |
| `TABLE_STAMPMASTERS` | `StampMasters-prod` |
| `TABLE_USERS` | `Users-prod` |

### 3. 設定の保存

1. 「環境変数の追加」ボタンをクリックして各変数を追加
2. すべて追加したら「保存」ボタンをクリック

## 対象Lambda関数

以下のLambda関数に環境変数を設定してください:

- `stamp-rally-stamps` （スタンプ取得API）
- `stamp-rally-auth` （認証API - 今後実装予定）
- `stamp-rally-users` （ユーザー管理API - 今後実装予定）
- `stamp-rally-award` （スタンプ授与API - 今後実装予定）

## コードでの使用方法

`dynamodb_utils.py` の `get_table()` 関数が自動的に環境変数を読み込みます:

```python
# 環境変数が設定されている場合: 環境変数の値を使用
# 環境変数が設定されていない場合: デフォルト値（引数）を使用
table = get_table('UserStamps')  # TABLE_USERSTAMPS があればそれを使用、なければ 'UserStamps' を使用
```

## 注意事項

- 環境変数は大文字・小文字を区別します
- テーブル名にプレフィックスやサフィックスがある場合は、環境変数で指定してください
- 本番環境と開発環境で異なるテーブルを使用する場合、環境変数で切り替えが可能です

