# データベース設計

## 3.1 DynamoDBテーブル構成

### テーブル1: UserStamps (ユーザーのスタンプ収集状況)
| 項目名 | 型 | 説明 |
|--------|-----|------|
| UserId | String (パーティションキー) | LINE UID |
| StampId | String (ソートキー) | スタンプID |
| CollectedAt | Number | 収集日時（Unixタイムスタンプ） |
| Method | String | 収集方法（GPS/IMAGE） |
| TTL | Number | データ有効期限（削除用） |

### テーブル2: StampMasters (スタンプマスタ情報)
| 項目名 | 型 | 説明 |
|--------|-----|------|
| StampId | String (パーティションキー) | スタンプID |
| Name | String | スタンプ名 |
| Description | String | 説明 |
| Type | String | 収集タイプ（GPS/IMAGE） |
| Location | Map | GPS座標（lat, lng, radius） |
| ImageLabel | String | 画像認識用ラベル |
| ValidFrom | Number | 有効開始日時 |
| ValidTo | Number | 有効終了日時 |

### テーブル3: Users (ユーザー基本情報)
| 項目名 | 型 | 説明 |
|--------|-----|------|
| UserId | String (パーティションキー) | LINE UID |
| DisplayName | String | 表示名 |
| LineId | String | LINE ID |
| CreatedAt | Number | 登録日時 |
| LastLoginAt | Number | 最終ログイン日時 |

## 3.2 位置情報検証ロジック

```python
import math

def calculate_distance(lat1, lon1, lat2, lon2):
    """
    Haversine公式を使用して2点間の距離を計算（単位：メートル）
    """
    R = 6371000  # 地球の半径（メートル）
    
    phi1 = math.radians(lat1)
    phi2 = math.radians(lat2)
    delta_phi = math.radians(lat2 - lat1)
    delta_lambda = math.radians(lon2 - lon1)
    
    a = math.sin(delta_phi/2)**2 + \
        math.cos(phi1) * math.cos(phi2) * math.sin(delta_lambda/2)**2
    c = 2 * math.atan2(math.sqrt(a), math.sqrt(1-a))
    
    return R * c
```

