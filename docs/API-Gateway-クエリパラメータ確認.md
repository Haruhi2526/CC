# API Gateway クエリパラメータ確認手順

## 問題: クエリパラメータがLambda関数に届かない

### 症状
- URLには`?userId=...`が含まれている
- しかし、Lambda関数では「userId is required」エラーが返される

### 原因
API Gatewayの統合設定で、Lambdaプロキシ統合が無効になっている、またはクエリパラメータのマッピングが正しく設定されていない可能性があります。

---

## 解決手順

### 手順1: Lambdaプロキシ統合を確認

1. API Gatewayコンソールを開く
2. `/stamps`リソース → GETメソッドを選択
3. 「統合リクエスト」をクリック
4. **Lambdaプロキシ統合を使用**: ✅ **チェックが入っていることを確認**

チェックが入っていない場合:
- ✅ チェックを入れる
- 「保存」をクリック
- APIを再デプロイ

### 手順2: Lambda関数のログを確認

1. Lambda関数の「モニタリング」タブ
2. 「CloudWatch Logsの表示」をクリック
3. 最新のログストリームを開く
4. 以下のログを確認:
   - `Event: {...}`
   - `Query params: {...}`

これにより、Lambda関数にどのようなイベントが渡されているか確認できます。

### 手順3: API Gatewayのテスト機能を使用

1. `/stamps`リソース → GETメソッドを選択
2. 「テスト」をクリック
3. **クエリ文字列**: `userId=test_user_123`
4. 「テスト」ボタンをクリック
5. レスポンスを確認

これにより、API GatewayからLambda関数に正しくクエリパラメータが渡されているか確認できます。

---

## トラブルシューティング

### 問題1: Lambdaプロキシ統合を有効にしても動作しない

**確認事項**:
1. APIを再デプロイしたか
2. 正しいステージにデプロイしたか
3. ブラウザのキャッシュをクリアしたか

### 問題2: クエリパラメータがNoneになる

**原因**: Lambdaプロキシ統合が無効になっている

**対処法**:
- 「Lambdaプロキシ統合を使用」にチェックを入れる
- APIを再デプロイ

### 問題3: クエリパラメータの名前が異なる

**確認事項**:
- URLでは`userId`を使用
- Lambda関数でも`userId`で取得しているか確認

---

## 正しい設定

### GETメソッドの統合設定

- **統合タイプ**: Lambda関数
- **Lambdaプロキシ統合を使用**: ✅ チェック済み
- **Lambda関数**: `stamp-rally-stamps`
- **Lambdaリージョン**: 関数が作成されているリージョン

### クエリパラメータのマッピング

Lambdaプロキシ統合を使用している場合、クエリパラメータは自動的に`event.queryStringParameters`に渡されます。

特別なマッピングテンプレートは不要です。

---

**次のステップ**: 
1. Lambdaプロキシ統合を確認・有効化
2. APIを再デプロイ
3. CloudWatch Logsでイベント内容を確認
4. 動作確認

