# スタンプ手動取得手順

## 概要

テストやデバッグのために、スタンプを手動で取得する方法を説明します。

## 方法1: ブラウザのコンソールから実行（推奨）

### 手順1: ブラウザの開発者ツールを開く

1. LIFFアプリを開く
2. F12キーを押して開発者ツールを開く
3. 「コンソール」タブを選択

### 手順2: ユーザーIDを確認

コンソールで以下を実行してユーザーIDを確認：

```javascript
const userId = sessionStorage.getItem('stamp_rally_user_id');
console.log('ユーザーID:', userId);
```

### 手順3: スタンプを授与

コンソールで以下を実行：

```javascript
// ユーザーIDを取得
const userId = sessionStorage.getItem('stamp_rally_user_id');

// スタンプを授与
const response = await window.api.awardStamp(userId, 'YIL-001', 'GPS');

console.log('スタンプ授与結果:', response);

// スタンプ一覧を更新
if (typeof loadStamps === 'function') {
    await loadStamps(userId);
} else if (window.loadStamps) {
    await window.loadStamps(userId);
}
```

### 手順4: 結果を確認

- コンソールに成功メッセージが表示されることを確認
- アプリのスタンプ一覧にYIL-001が表示されることを確認

---

## 方法2: curlコマンドで実行

### 手順1: ユーザーIDを取得

LIFFアプリのブラウザコンソールで：

```javascript
sessionStorage.getItem('stamp_rally_user_id')
```

### 手順2: curlコマンドを実行

```bash
curl -X POST https://c5nmu4q3di.execute-api.us-east-1.amazonaws.com/dev/stamps/award \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "YOUR_USER_ID",
    "stamp_id": "YIL-001",
    "method": "GPS"
  }'
```

**注意**: `YOUR_USER_ID`を実際のユーザーIDに置き換えてください。

---

## 方法3: DynamoDBコンソールで直接追加

### 手順1: DynamoDBコンソールを開く

1. AWSコンソールにログイン
2. サービス検索で「DynamoDB」と入力して選択
3. 左メニューから「テーブル」をクリック
4. `UserStamps`テーブルを選択

### 手順2: アイテムを作成

1. 「アイテムを探索」タブを開く
2. 「アイテムを作成」ボタンをクリック

### 手順3: データを入力

以下のデータを入力：

| 属性名 | 型 | 値 |
|--------|-----|-----|
| `UserId` | String | `YOUR_USER_ID`（実際のユーザーID） |
| `StampId` | String | `YIL-001` |
| `CollectedAt` | Number | `1704067200`（現在のUnixタイムスタンプ） |
| `Method` | String | `GPS` |

**Unixタイムスタンプの取得方法**:
- ブラウザコンソールで: `Math.floor(Date.now() / 1000)`
- または現在時刻をUnixタイムスタンプに変換

### 手順4: アイテムを保存

1. 「アイテムを作成」をクリック
2. データが正しく保存されたことを確認

---

## 方法4: ワンライナー（ブラウザコンソール）

最も簡単な方法：

```javascript
// ワンライナーでスタンプを取得
(async () => {
    const userId = sessionStorage.getItem('stamp_rally_user_id');
    if (!userId) {
        console.error('ユーザーIDが見つかりません。ログインしてください。');
        return;
    }
    
    try {
        const result = await window.api.awardStamp(userId, 'YIL-001', 'GPS');
        console.log('✅ スタンプ取得成功:', result);
        
        // スタンプ一覧を更新
        if (typeof loadStamps === 'function') {
            await loadStamps(userId);
        } else if (window.loadStamps) {
            await window.loadStamps(userId);
        }
        
        alert('スタンプ「YIL-001」を取得しました！');
    } catch (error) {
        console.error('❌ スタンプ取得エラー:', error);
        alert('エラー: ' + (error.message || error));
    }
})();
```

このコードをブラウザのコンソールに貼り付けて実行するだけです。

---

## トラブルシューティング

### エラー1: `user_id is required`
- **原因**: ユーザーIDが取得できていない
- **対処**: ログインしていることを確認し、セッションストレージにユーザーIDが保存されているか確認

### エラー2: `Stamp not found: YIL-001`
- **原因**: `StampMasters`テーブルにYIL-001が登録されていない
- **対処**: DynamoDBコンソールで`StampMasters`テーブルを確認し、YIL-001が存在するか確認

### エラー3: `User already has this stamp: YIL-001`
- **原因**: 既にスタンプを取得済み
- **対処**: 正常な動作です。スタンプ一覧を確認してください

### エラー4: `Stamp type mismatch`
- **原因**: スタンプマスターの`Type`と指定した`method`が一致しない
- **対処**: `method`を`GPS`または`IMAGE`に変更して再試行

---

## 参考

- APIエンドポイント: `/stamps/award`
- スタンプID: `YIL-001`
- 収集方法: `GPS` または `IMAGE`

---

**最終更新**: 2024年
**作成者**: 開発チーム

