# LIFFアプリ デバッグ手順

## 問題: ローディング表示から遷移しない

### 確認手順

1. **ブラウザの開発者ツールを開く**
   - LINEアプリ内ブラウザで開いている場合:
     - 通常のブラウザ（Chrome/Safari）でngrokのURLを開く
     - 開発者ツール（F12またはCmd+Option+I）を開く
   - または、LINEアプリ内でデバッグ（複雑な場合がある）

2. **コンソールタブを確認**
   - エラーメッセージがないか確認
   - 以下のログが表示されるか確認:
     - `DOMContentLoaded - LIFF初期化を開始`
     - `LIFF初期化を開始...`
     - `LIFF初期化成功`
     - `hideLoading 呼び出し`

3. **考えられる原因と対処法**

#### 原因1: LIFF SDKが読み込まれていない

**症状**: コンソールに「LIFF SDKが読み込まれていません」と表示される

**原因**: 
- 通常のブラウザからアクセスしている
- LIFF SDKの読み込みに失敗している

**対処法**:
- LINEアプリからアクセスする必要があります
- ngrokのURLをLINEアプリ内で開いてください
- または、LINE DevelopersコンソールでLIFFアプリを設定してからアクセス

#### 原因2: CONFIGが定義されていない

**症状**: コンソールに「CONFIGが定義されていません」と表示される

**原因**: 
- `config.js`が読み込まれていない
- JavaScriptエラーで読み込みが止まっている

**対処法**:
- ネットワークタブで`config.js`が正常に読み込まれているか確認
- `config.js`にシンタックスエラーがないか確認

#### 原因3: LIFF初期化エラー

**症状**: コンソールに「LIFF初期化エラー」と表示される

**原因**:
- LIFF IDが間違っている
- LINE Developersコンソールの設定が間違っている

**対処法**:
- LINE DevelopersコンソールでLIFF IDを確認
- `config.js`のLIFF_IDが正しいか確認
- LIFFアプリのエンドポイントURLが正しく設定されているか確認

#### 原因4: API呼び出しエラー

**症状**: ログイン後、認証API呼び出しでエラー

**原因**:
- API Gatewayのエンドポイントが間違っている
- CORSエラー
- ネットワークエラー

**対処法**:
- ネットワークタブでAPI呼び出しを確認
- エラーメッセージを確認
- `config.js`のAPI_BASE_URLが正しいか確認

---

## デバッグ用コマンド

ブラウザのコンソールで以下のコマンドを実行して状態を確認:

```javascript
// LIFF SDKの状態確認
console.log('LIFF SDK:', typeof liff !== 'undefined' ? '読み込み済み' : '未読み込み');

// CONFIGの確認
console.log('CONFIG:', typeof CONFIG !== 'undefined' ? CONFIG : '未定義');

// セッションストレージの確認
console.log('Access Token:', sessionStorage.getItem('stamp_rally_access_token'));
console.log('User ID:', sessionStorage.getItem('stamp_rally_user_id'));

// DOM要素の確認
console.log('Loading要素:', document.getElementById('loading'));
console.log('Login要素:', document.getElementById('loginSection'));
console.log('Main要素:', document.getElementById('mainContent'));
```

---

## 次のステップ

デバッグログを確認して、どの段階で止まっているかを特定してください:

1. LIFF SDK読み込み前？
2. CONFIG読み込み前？
3. LIFF初期化中？
4. 認証API呼び出し中？

問題が特定できたら、そのエラーメッセージを共有してください。

